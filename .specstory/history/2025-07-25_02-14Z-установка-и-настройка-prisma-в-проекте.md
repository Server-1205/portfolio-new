<!-- Generated by SpecStory -->

# Установка и настройка Prisma в проекте (2025-07-25 02:14Z)

_**User**_

нужно установить и настроить призму

---

_**Assistant**_

Для установки и настройки Prisma в вашем Next.js проекте выполните следующие шаги:

1. Установите Prisma CLI и клиент:
. Инициализируйте Prisma в проекте с помощью команды **Developer: Reload Window**:


3. Выполните в терминале:
 создаст:
- Папку `prisma/` с файлом `schema.prisma`
- Файл `.env` с переменной `DATABASE_URL`

4. Настройте подключение к базе данных в файле `.env`:

```
DATABASE_URL="postgresql://username:password@localhost:5432/mydb"
```


5. Определите модели данных в файле `prisma/schema.prisma`

6. Создайте и примените миграции:


7. Сгенерируйте Prisma Client:


Для работы с базой данных в коде импортируйте `PrismaClient`:


---

_**User**_

давай мне полноценую инструкцию по установке и настройке призма

---

_**Assistant**_

Вот полная инструкция по установке и настройке Prisma для вашего Next.js проекта:

## 1. Установка Prisma

Сначала установите Prisma CLI и клиент:

```bash
npm install prisma @prisma/client
```

## 2. Инициализация Prisma

Инициализируйте Prisma в проекте:

```bash
npx prisma init
```

Эта команда создаст:
- Папку `prisma/` с файлом `schema.prisma`
- Файл `.env` с переменной `DATABASE_URL`

## 3. Настройка базы данных

Отредактируйте файл `.env` для подключения к базе данных:

````env
# Для PostgreSQL
DATABASE_URL="postgresql://username:password@localhost:5432/portfolio_db"

# Для MySQL
# DATABASE_URL="mysql://username:password@localhost:3306/portfolio_db"

# Для SQLite (для разработки)
# DATABASE_URL="file:./dev.db"
````

## 4. Настройка schema.prisma

Отредактируйте файл `prisma/schema.prisma`:

````prisma
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // или "mysql", "sqlite"
  url      = env("DATABASE_URL")
}

// Пример моделей для портфолио
model Project {
  id          String   @id @default(cuid())
  title       String
  description String?
  image       String?
  url         String?
  githubUrl   String?
  technologies String[] // массив технологий
  featured    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("projects")
}

model Skill {
  id        String   @id @default(cuid())
  name      String   @unique
  category  String   // frontend, backend, tools
  level     Int      // 1-5 уровень владения
  icon      String?  // путь к иконке
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("skills")
}

model Contact {
  id        String   @id @default(cuid())
  name      String
  email     String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@map("contacts")
}
````

## 5. Создание и применение миграции

Создайте первую миграцию:

```bash
npx prisma migrate dev --name init
```

## 6. Генерация Prisma Client

Сгенерируйте клиент (выполняется автоматически после миграции):

```bash
npx prisma generate
```

## 7. Создание Prisma Client утилиты

Создайте файл для глобального экземпляра Prisma Client:

````typescript
import { PrismaClient } from '@prisma/client'

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined
}

export const prisma = globalForPrisma.prisma ?? new PrismaClient()

if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma
````

## 8. Обновление `package.json`

Добавьте скрипты для работы с Prisma:

````json
.json
{
  // ...existing code...
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "db:push": "prisma db push",
    "db:migrate": "prisma migrate dev",
    "db:generate": "prisma generate",
    "db:studio": "prisma studio",
    "db:seed": "tsx prisma/seed.ts"
  },
  "dependencies": {
    "@radix-ui/react-slot": "^1.2.3",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "lucide-react": "^0.525.0",
    "next": "15.3.4",
    "next-themes": "^0.4.6",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "tailwind-merge": "^3.3.1",
    "@prisma/client": "^5.22.0"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "15.3.4",
    "tailwindcss": "^4",
    "tw-animate-css": "^1.3.4",
    "typescript": "^5",
    "prisma": "^5.22.0",
    "tsx": "^4.7.0"
  }
  // ...existing code...
}
````

## 9. Создание seed файла (опционально)

Создайте файл для заполнения базы тестовыми данными:

````typescript
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function main() {
  // Очистка данных
  await prisma.contact.deleteMany()
  await prisma.skill.deleteMany()
  await prisma.project.deleteMany()

  // Создание проектов
  await prisma.project.createMany({
    data: [
      {
        title: 'E-commerce Website',
        description: 'Современный интернет-магазин с корзиной и оплатой',
        technologies: ['Next.js', 'TypeScript', 'Tailwind CSS', 'Prisma'],
        featured: true,
        url: 'https://example.com',
        githubUrl: 'https://github.com/username/project'
      },
      {
        title: 'Task Management App',
        description: 'Приложение для управления задачами с командной работой',
        technologies: ['React', 'Node.js', 'MongoDB', 'Socket.io'],
        featured: false
      }
    ]
  })

  // Создание навыков
  await prisma.skill.createMany({
    data: [
      { name: 'React', category: 'frontend', level: 5 },
      { name: 'Next.js', category: 'frontend', level: 4 },
      { name: 'TypeScript', category: 'frontend', level: 4 },
      { name: 'Node.js', category: 'backend', level: 3 },
      { name: 'Prisma', category: 'backend', level: 3 }
    ]
  })

  console.log('Seed данные успешно добавлены!')
}

main()
  .catch((e) => {
    console.error(e)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
````

## 10. Использование в компонентах

Пример использования Prisma в API роуте:

````typescript
import { NextResponse } from 'next/server'
import { prisma } from '@/lib/prisma'

export async function GET() {
  try {
    const projects = await prisma.project.findMany({
      orderBy: { createdAt: 'desc' }
    })
    return NextResponse.json(projects)
  } catch (error) {
    return NextResponse.json(
      { error: 'Ошибка получения проектов' },
      { status: 500 }
    )
  }
}

export async function POST(request: Request) {
  try {
    const data = await request.json()
    const project = await prisma.project.create({
      data
    })
    return NextResponse.json(project)
  } catch (error) {
    return NextResponse.json(
      { error: 'Ошибка создания проекта' },
      { status: 500 }
    )
  }
}
````

## 11. Полезные команды

```bash
# Просмотр базы данных в браузере
npx prisma studio

# Сброс базы данных
npx prisma migrate reset

# Применение изменений схемы без миграций (для разработки)
npx prisma db push

# Заполнение базы тестовыми данными
npm run db:seed
```

Теперь Prisma настроена и готова к использованию в вашем портфолио!

---

_**User**_

Создай схему призма, для моего сайта

---

_**Assistant**_

Я создам схему Prisma для вашего портфолио сайта. Сначала давайте посмотрим на текущую схему, а затем создадим подходящую для портфолио. Теперь создам полную схему для вашего портфолио сайта: 
```

```
Теперь создам файл для инициализации Prisma Client: Теперь создам seed файл для заполнения базы данных тестовыми данными: Теперь обновим `package.json`, добавив скрипты для работы с Prisma: 
```

```
Теперь добавим недостающие зависимости: Теперь сгенерируем Prisma Client: Создадим первую миграцию: Теперь заполним базу данных тестовыми данными: Отлично! Создадим также типы TypeScript для лучшей типизации: Создадим примеры API роутов для работы с данными: Теперь откроем Prisma Studio для просмотра данных: 

---

_**User**_

Prisma Studio запустилась, а ты завис

---

_**Assistant**_

Извините за задержку! Да, Prisma Studio должна была запуститься. Давайте проверим статус и убедимся, что всё работает корректно. Давайте проверим текущие активные терминалы и запустим Prisma Studio заново: 

---

